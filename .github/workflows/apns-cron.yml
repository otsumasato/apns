name: apns-cron
on:
  # 手動実行（Actions に Run workflow ボタンが出ます）
  workflow_dispatch:
    inputs:
      device_token:
        description: "Override device token (optional)"
        required: false
      env:
        description: "APNs environment"
        type: choice
        options: [sandbox, production]
        default: sandbox
  # 5分ごとに自動実行
  schedule:
    - cron: "*/5 * * * *"   # UTCで5分おき

jobs:
  send:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/setup-python@v5
        with:
          python-version: '3.12'

      - name: Install deps (JWT only)
        run: |
          python -V
          pip install "PyJWT>=2.8" "cryptography>=42"

      # ✅ Secrets が"存在するかだけ"を確認（中身は表示しない）
      - name: Check secrets presence (no values printed)
        shell: bash
        env:
          S_TEAM: ${{ secrets.APNS_TEAM_ID }}
          S_KEY: ${{ secrets.APNS_KEY_ID }}
          S_PEM: ${{ secrets.APNS_P8_PEM || secrets.APN_SECRETS }}
          S_TOPIC: ${{ secrets.APNS_TOPIC }}
          S_DEVS: ${{ secrets.DEVICE_TOKENS }}
        run: |
          for v in S_TEAM S_KEY S_PEM S_TOPIC; do
            if [ -z "${!v}" ]; then echo "❌ $
